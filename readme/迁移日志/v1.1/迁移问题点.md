# 初衷
增加键盘监听事件


# 关键问题

## 如何增加键盘监听
通过扩展MEF的方式扩展Microsoft.VisualStudio.Text.Editor 组件

有两种方式
一种是
IKeyProcessorProvider

可以监听到基本按键的按下和弹起的事件


注意点：
>但是一些按键时间会被吞掉，比如ctrl+s等组合键，enter和backspace的keydown事件
>
>一次长时间按压会触发多次keyDown事件，但是只有一次keyUp事件（在事件被吞掉的情况下，keyDown事件会丢失）
>
>如果开启了输入法，那么输入的字符的keyDown事件内容可可能为ImeProcessed，

另外一种是
IOleCommandTarget
这部分是经过一部分处理的事件，在这个环节可以接收到backspace和enter事件。

注意点：
> 有一些命令无法在这部分接收到，比如redo undo cpc命令，save命令


## 解决模块依赖和强签名的问题

切分出来的所有项目，项目类型都设置为类库项目，然后根据模块依赖关系添加项目依赖即可。

强签名依赖的项目，也必须是强签名，项目中所有的CppMonitor.开头的项目的强签名密码与文件名一致，

## Build模块异步方式捕获编译输出会导致空针问题
借鉴OBSIDE的实现方式，采用dte2.ToolWindows.ErrorList.ErrorItems的方式捕获编译错误

## CopyUtil:: CopySolutionFile 实现存在问题

之前的实现方案是根据
VS中项目的过滤器和文件的方式来组织的
这里没有直接拷贝项目文件夹时因为存在一个链接文件的问题，也就是文件本身不在项目目录下

变更初衷：
这部分的情况比较少，但是不是没有，需要考虑到
根据VS的设计，链接进来的文件会放在项目视图的根目录显示出来，相同文件名的不同文件可以被同时添加进来
头文件没有被包含进来的情况也会出现，但是项目能够成功编译

项目文件夹外部的文件之间的相对位置只能通过分析头文件的方式实现

变更实现方式：
考虑到文件组织的方式
这里直接将对应项目的 filters文件拷贝过来

## 获取解决方案的名称
在官网的接口中没有找到获取解决方案名称的接口，只能通过EnvDTE.Solution.FullName拿到sln文件的路径，根据实验，解决方案名称与该文件名称一致

所以在File监控模块的 FileLogUtil.logSolutionOpenEvent方法中通过识别解决方案名称来实现获取解决方案名称的功能

## 监控重命名项目事件
https://social.msdn.microsoft.com/Forums/vstudio/en-US/bc0b1c80-0f80-45e8-8b49-bb67d012547a/solutioneventsprojectrenamed-will-not-fire-off?forum=vsx&forum=vsx
上面的内容表示 mSolutionEvents.ProjectRenamed 在C++项目中 不会被触发

所以这里采用监控VS层次目录变化来实现相关功能