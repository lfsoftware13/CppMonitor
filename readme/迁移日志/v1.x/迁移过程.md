# 迁移目标 #

讲项目从原来的vs2015环境迁移到vs2017环境下


# 关键问题 #


## <del>.net framework存在问题 </del>##
<del>项目以来的.net framework 为 v4.5，而新版的.net framework 为v4.7.2 首先需要将对应的版本升级过来</del>

(vs2017默认支持4.6.1 只需要将对应的框架 改为4.6.2即可)

### 子问题1 ： vs2017 默认不支持 v4.7+ ###

运行vs installer  在组建中找到v4.7.2 相关的组件，勾选并安装


### 子问题2 ： 未能解析目标框架“.NETFramework,Version=v4.7.2”的 mscorlib ###

首先确定电脑中已经安装了.net framework v4.7.2

其次确定vs 2017已经支持v4.7.2
（右击项目  -> 属性 ->  应用程序 -> 目标框架 ，下拉框中看到v4.7.2 即可)

将项目的目标框架修改成v4.7.2
（经过验证，这一步位置就可以解决绝大多数的问题了，一定要重新加载项目）

最后确认项目的配置文件中是否存在于目标框架v4.7.2不一致的地方


## CS1748 找不到与嵌入互操作类型 ***.IVsToolboxItemProvider2 相匹配的互操作类型 ##

问题出现在CppMonitorPackage.cs文件中，在整个解决方案中都没有用到过IVsToolboxItemProvider2，所以可以定位为库文件缺失

在微软官方文档中找到如下描述
```
IVsToolboxItemProvider2 Interface
Definition
Namespace:
Microsoft.VisualStudio.Shell.Interop
Assemblies:
Microsoft.VisualStudio.Shell.15.0.dll, Microsoft.VisualStudio.Shell.Interop.15.3.DesignTime.dll
```

在项目中引入对应的两个依赖就可以了


## CS1752 无法嵌入互操作类型“Constants”。请改用适用的接口。 ##
问题出现在CppMonitor\Monitor\CommandMonitor\CommandUtil.cs中80行等一系列位置中

经过检索这个是因为导入的引用配置不正确而引发的

将对应引用的 “嵌入互操作类型”设置为False 即可

## vsixmanifest must contains a value for PackageManifest:Prerequisites ##

这个问题是扩展插件升级到vs2017上必须添加的。
详细的描述请参考https://docs.microsoft.com/zh-cn/visualstudio/extensibility/how-to-migrate-extensibility-projects-to-visual-studio-2017?view=vs-2017

### 子问题1 确认最小的Prerequisites ###
经过验证实际上安装包中的配置文件没有这个配置也能够正常的安装，这个只是做一个提前的检查，
按照之前的经验，基本不需要配置这个，所以按照官方样例，直接限制核心编辑器是vs2017的版本即可，配置如下(notepad配置，ide中不支持,这么写)
```
 <Prerequisite Id="Microsoft.VisualStudio.Component.CoreEditor" Version="[15.0,16.0)" />
```

### 子问题2 VSIXInstaller.NoApplicableSKUsException ###
电脑上没有支持安装的产品。
经过检查这一点还是由安装检查引发的
在配置文件中加入下面的配置，就可以支持所有的vs2017 comunity版本了
```
<InstallationTarget Version="[15.0,16.0)" Id="Microsoft.VisualStudio.Community" />
```

#### 子问题3 无法通过安装检查 ####
经过一步步筛选，最后确定，在原始配置中限制了MPF版本为MPF12，而在vs2017中已经升级到了MPF14+，由于对应的限制条目已经有一条了，所以这一条检查可以不用保留，直接删除即可。


## 无法加载 Sqlite.Interop.dll ##

目前为止还不确定具体原因，只能根据最后解决方案推测可能原因
1 原本项目中的Sqlite.Interop.dll是基于.net framework v4.5的，这个版本的dll并不向后兼容
2 Sqlite.Interop.dll 需要被包含在项目文件中，并配置成复制到输出目录，并且被包含在vsix文件中
3 编译目标平台是x86，所以Sqlite.Interop.dll也需要选择x86平台的